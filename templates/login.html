
   
    <html>

        <head>
            <!-- Standard Meta -->
            <meta charset="utf-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        
            <!-- Site Properties -->
            <title>Login</title>
            <link rel="shortcut icon" href="{{ url_for('static', filename = 'favicon.ico') }}"/>
            <!-- You MUST include jQuery before Fomantic -->
            <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css">
            <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script>
            <script src="{{ url_for('static', filename= '/js/sha1.min.js') }}""></script>

            <style type="text/css">
            body>.grid {
            height: 100%;
        }

        .image {
            margin-top: -100px;
        }

        .column {
            max-width: 450px;
        }
                .hidden.menu {
                    display: none;
                }
        
                
                .ui.vertical.stripe {
                    padding: 8em 0em;
                }
        
                .ui.vertical.stripe h3 {
                    font-size: 2em;
                }
        
                .ui.vertical.stripe .button+h3,
                .ui.vertical.stripe p+h3 {
                    margin-top: 3em;
                }
        
                .ui.vertical.stripe .floated.image {
                    clear: both;
                }
        
                .ui.vertical.stripe p {
                    font-size: 1.33em;
                }
        
                .ui.vertical.stripe .horizontal.divider {
                    margin: 3em 0em;
                }
        
                .quote.stripe.segment {
                    padding: 0em;
                }
        
                .quote.stripe.segment .grid .column {
                    padding-top: 5em;
                    padding-bottom: 5em;
                }
        
                .footer.segment {
                    padding: 5em 0em;
                }
        
                .secondary.pointing.menu .toc.item {
                    display: none;
                }
        
                @media only screen and (max-width: 700px) {
                    .ui.fixed.menu {
                        display: none !important;
                    }
        
                    .secondary.pointing.menu .item,
                    .secondary.pointing.menu .menu {
                        display: none;
                    }
        
                    .secondary.pointing.menu .toc.item {
                        display: block;
                    }
        
                    .masthead.segment {
                        min-height: 350px;
                    }
        
                    .masthead h1.ui.header {
                        font-size: 2em;
                        margin-top: 1.5em;
                    }
        
                    .masthead h2 {
                        margin-top: 0.5em;
                        font-size: 1.5em;
                    }
                }
            </style>
            <script>
                $(document)
                    .ready(function () {
        
                    
                        // create sidebar and attach to menu open
                        $('.ui.sidebar')
                            .sidebar('attach events', '.toc.item')
                            ;
        
                    })
                    ;
                    
            </script>
        </head>
        
        <body class="pushable">
            <!-- Following Menu -->
    <div class="ui large top fixed visible menu">
        <div class="ui container">
            <a class="item" href="{{ url_for('index') }}">Home</a>
            <a class="item">Campagna vaccinale</a>
            <a class="item">Info</a>
            <div class="right menu">
                <div class="item">
                    <a class="ui button">Login</a>
                </div>
                <div class="item">
                    <a class="ui primary button" href="{{ url_for('register') }}">Registrati</a>
                </div>
            </div>
        </div>
    </div>


    <!-- Sidebar Menu -->
    <div class="ui vertical inverted sidebar menu left">
        <a class="item" href="{{ url_for('index') }}">Home</a>
        <a class="item">Campagna vaccinale</a>
        <a class="item">Info</a>
        <a class="item" href="{{ url_for('login') }}">Login</a>
        <a class="item" href="{{ url_for('register') }}">Registrati</a>
    </div>
        
            <!-- Page Contents -->
            <div class="pusher">
                <div class="ui container">
                    <div class="ui large primary menu">
                        <a class="toc item">
                            <i class="sidebar icon"></i>
                        </a>
                        <a class="item" href="{{ url_for('index') }}">Home</a>
                        <a class="item">Campagna vaccinale</a>
                        <a class="item">Info</a>
                        <div class="right item">
                            <a class="ui inverted disabled button" >Login</a>
                            <a class="ui inverted button" href="{{ url_for('register') }}">Registrati</a>
                        </div>
                    </div>
                </div>
                
        
                <div class="ui vertical stripe segment">
                    <div class="ui middle aligned center aligned grid" >
                        <div class="column">
                            <h2 class="ui primary image header">
                                <img src="{{ url_for('static', filename = '/images/favicon5.png') }}" class="image">
                                <div class="content">
                                    Accedi al tuo account
                                </div>
                            </h2>
                        </div>
                    </div>
                    
                    <div id="login_div" class="doubling stackable three column ui grid container"  style="margin-top: 3em; display: block;">
                      <div class="column"></div>
                      <div id="form_container" class="column">
                        <form class="ui form segment" id="login_form">
                              <div class="field">
                                <label>Email</label>
                                <input placeholder="" name="email" type="email">
                              </div>
                                <div class="field">
                                    <label>Password</label>
                                    <input type="password" name="password">
                                  </div>
                            <div class="inline field">
                            </div>
                            <div class="ui primary submit button">Login</div>
                            <div class="ui error message"></div>
                          </form>
                          <div class="ui mini message">
                              <div class="ui header">
                                Non possiedi un account? <a href="{{ url_for('register') }}"> Registrati</a>
                              </div>
                              <div class="ui header" style="margin-top: 0.5em;">
                                Hai dimenticato la password? <a id="reset_password" style="cursor:pointer;"> Recupera </a>
                              </div>
                          </div>
                        </div>
                          <div class="column"></div>
                      </div>
                      <div id="reset_div" class="doubling stackable three column ui grid container"  style="margin-top: 3em; display: none;">
                        <div id="reset_dimmer" class="ui inverted dimmer">
                            <div class="ui loader"></div>
                          </div>
                        <div class="column"></div>
                        <div id="reset_form" class="column">
                           
                          <div class="ui form segment">
                              
                                <div class="field">
                                  <label>Email per il recupero</label>
                                  <input placeholder="" name="reset_email" type="email">
                                </div>
                              <div id="reset_button" class="ui primary button">Recupera</div>
                              
                            </div>
                            
                          </div>
                            <div class="column"></div>
                            
                        </div>
                </div>
        
        
        
        
                {% include 'footer.html' %}
            </div>
        </body>
        <script>
            
            $('.ui.form')
                    .form({
                        fields: {
                            email: {
                                identifier: 'email',
                                rules: [
                                    {
                                        type: 'empty',
                                        prompt: 'Inserisci la tua email'
                                    }
                                ]
                            },
                            password: {
                                identifier: 'password',
                                rules: [
                                    {
                                        type: 'empty',
                                        prompt: 'Inserisci la password'
                                    }
                                ]
                            }
                        },
                        onSuccess: function(event){
      $('#message').remove();
        $('#login_form').removeClass().addClass('ui loading form segment');
        $.ajax({
            type: 'POST',
            url: "{{ url_for('log_user') }}",
            data: { 
                'email': $('#login_form').form('get value', 'email'), 
                'password': hash_SHA1($('#login_form').form('get value', 'password')), 
            },
            success: function(data){
              $('#login_form').form('reset');
              $('#message').remove();
              /*
                $('#form_container').prepend(data);
                //new div is called 'message'
                $('#message').show('fast');
              */
             if (!data.includes('error')){
                window.location.href = "{{ url_for('profile') }}";
             }
            else {
                $('#login_form').removeClass().addClass('ui form segment');
                $('#form_container').prepend(data);
                //new div is called 'message'
                $('#message').show('fast');
            }
                   
            },
            error: function(data) {
                $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
              $('#login_form').removeClass().addClass('ui form segment');
              $('#message').remove();
              if (data){
                $('#form_container').prepend(data);
              } else {
                $('#form_container').prepend('<div id="message" class="ui error mini message"\
                style="display: none;"><div class="header">Si è verificato un errore nell\'accesso</div></div>');
              }
              $('#message').show('fast');
            }
        });
        event.preventDefault();
    }
                    })
                    ;
    function hash_SHA1(stringToBeHashed){
    sha1(stringToBeHashed);
    var hash = sha1.create();hash.update(stringToBeHashed);
    return hash.hex();
  }
  $('#reset_password').click( function() {
    $('#login_div').css('display','none');
    $('#reset_div').css('display','block');
  })
  $('#reset_button').click( function() {
    $('#reset_dimmer').addClass('active');
    $.ajax({
            type: 'POST',
            url: "{{ url_for('reset_password') }}",
            data: { 
                'email': $("input[name=reset_email]").val()
            },
            success: function(data){
                $('#reset_form').find(":first-child").remove();
                $('#reset_dimmer').removeClass('active');
                console.log(data);
                $('#reset_form').prepend(data);
            },
            error: function(data) {
                $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                $('#reset_form').find(":first-child").remove();
                $('#reset_dimmer').removeClass('active');
                console.log(data);
                $('#reset_form').prepend('<div class="ui error message">\
                    <div class="header">Si è verificato un errore di connessione</div>\
                    <p>' + data + '</p>\
                    </div>')
            }
        });
  });
        </script>
        
        </html>