<html>

<head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <!-- Site Properties -->
    <title>Registrati</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename = 'favicon.ico') }}"/>
    <!-- You MUST include jQuery before Fomantic -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script>
    <script src="{{ url_for('static', filename= '/js/sha1.min.js') }}""></script>

    <style type="text/css">
        .hidden.menu {
            display: none;
        }

        
        .ui.vertical.stripe {
            padding: 8em 0em;
        }

        .ui.vertical.stripe h3 {
            font-size: 2em;
        }

        .ui.vertical.stripe .button+h3,
        .ui.vertical.stripe p+h3 {
            margin-top: 3em;
        }

        .ui.vertical.stripe .floated.image {
            clear: both;
        }

        .ui.vertical.stripe p {
            font-size: 1.33em;
        }

        .ui.vertical.stripe .horizontal.divider {
            margin: 3em 0em;
        }

        .quote.stripe.segment {
            padding: 0em;
        }

        .quote.stripe.segment .grid .column {
            padding-top: 5em;
            padding-bottom: 5em;
        }

        .footer.segment {
            padding: 5em 0em;
        }

        .secondary.pointing.menu .toc.item {
            display: none;
        }

        @media only screen and (max-width: 700px) {
            .ui.fixed.menu {
                display: none !important;
            }

            .secondary.pointing.menu .item,
            .secondary.pointing.menu .menu {
                display: none;
            }

            .secondary.pointing.menu .toc.item {
                display: block;
            }

            .masthead.segment {
                min-height: 350px;
            }

            .masthead h1.ui.header {
                font-size: 2em;
                margin-top: 1.5em;
            }

            .masthead h2 {
                margin-top: 0.5em;
                font-size: 1.5em;
            }
        }
    </style>
    <script>
        $(document)
            .ready(function () {

                
                // create sidebar and attach to menu open
                $('.ui.sidebar')
                    .sidebar('attach events', '.toc.item')
                    ;

            })
            ;
    </script>
</head>

<body class="pushable">

    <!-- Following Menu -->
    <div class="ui large top fixed visible menu">
        <div class="ui container">
          <a class="item" href="{{ url_for('home', param='Home') }}">Home</a>
          <a class="item" href="{{ url_for('home', param='Campagna vaccinale') }}">Campagna vaccinale</a>
          <a class="item" href="{{ url_for('home', param='Info') }}">Info</a>
            <div class="right menu">
                <div class="item">
                    <a class="ui button" href="{{ url_for('login') }}">Log in</a>
                </div>
                <div class="item">
                    <a class="ui primary disabled button">Registrati</a>
                </div>
            </div>
        </div>
    </div>


    <!-- Sidebar Menu -->
    <div class="ui vertical inverted sidebar menu left">
      <a class="item" href="{{ url_for('home', param='Home') }}">Home</a>
      <a class="item" href="{{ url_for('home', param='Campagna vaccinale') }}">Campagna vaccinale</a>
      <a class="item" href="{{ url_for('home', param='Info') }}">Info</a>
        <a class="item" href="{{ url_for('login') }}">Login</a>
        <a class="item" href="{{ url_for('register') }}">Registrati</a>
    </div>

    <!-- Page Contents -->
    <div class="pusher">
        <div class="ui container">
            <div class="ui large primary menu">
                <a class="toc item">
                    <i class="sidebar icon"></i>
                </a>
                <a class="item" href="{{ url_for('home', param='Home') }}">Home</a>
            <a class="item" href="{{ url_for('home', param='Campagna vaccinale') }}">Campagna vaccinale</a>
            <a class="item" href="{{ url_for('home', param='Info') }}">Info</a>
                <div class="right item">
                    <a class="ui inverted button" href="{{ url_for('login') }}">Login</a>
                    <a class="ui inverted disabled button">Registrati</a>
                </div>
            </div>
        </div>
        <div class="ui vertical stripe segment">
            <div class="ui middle aligned center aligned grid" style="margin-top: -5em;">
                <div class="column">
                    <h2 class="ui primary image header">
                        <img src="{{ url_for('static', filename = '/images/favicon5.png') }}" class="image">
                        <div class="content">
                            Registrati a VaccItaly
                        </div>
                    </h2>
                </div>
            </div>
            
            <div class="ui text container" id="form_container" style="margin-top: 3em;">
              
                <form class="ui form segment" id="register_form">
                    <div class="two fields">
                      <div class="field">
                        <label>Nome</label>
                        <input placeholder="" name="nome" type="text">
                      </div>
                      <div class="field">
                        <label>Cognome</label>
                        <input placeholder="" name="cognome" type="text">
                      </div>
                    </div>
                    <div class="two fields">
                        <div class="field">
                            <label>Data di nascita</label>
                            <div class="ui calendar" id="data_nascita">
                                <div class="ui input left icon">
                                  <i class="calendar icon"></i>
                                  <input type="text" placeholder="" name="data_nascita">
                                </div>
                              </div>
                          </div>
                          <div class="field">
                            <label>Luogo di nascita</label>
                            <input placeholder="" name="luogo_nascita" type="text" >
                          </div>
                    </div>
                    <div class="two fields">
                      <div class="field">
                        <label>Email</label>
                        <input placeholder="" name="email" type="email">
                      </div>
                      <div class="field">
                        <label>Codice fiscale</label>
                        <input placeholder="" name="CF" type="text" style="text-transform:uppercase">
                      </div>
                    </div>
                    <div class="two fields">
                        <div class="field">
                            <label>Password</label>
                            <input type="password" name="password1">
                          </div>
                          <div class="field">
                            <label>Conferma password</label>
                            <input type="password" name="password2">
                          </div>
                    </div>
                    <div class="inline field">
                      <div class="ui checkbox">
                        <input type="checkbox" name="terms" tabindex="0" >
                        <label>Accetto i <a href="{{ url_for('terms') }}" target="_blank">termini e le condizioni</a></label>
                      </div>
                    </div>
                    <div class="ui primary submit button">Registrati</div>
                    <div class="ui error message"></div>
                  </form>
                  <div id="mini_message" class="ui mini message">
                    <div class="header">Gi√† possiedi un account? <a href="{{ url_for('login') }}"> Login</a></div>
                  </div>
              </div>
        </div>




        {% include 'footer.html' %}
    </div>
</body>
<script>
var mysqlDate = null;
//Calendar check dates between 1/1/1900 - 31/12/2099
$('.ui.form')
    .form({
      fields: {
        nome: {
          identifier: 'nome',
          rules: [
            {
              type   : 'empty',
              prompt : 'Inserisci il tuo nome'
            }
          ]
        },
        cognome: {
          identifier: 'cognome',
          rules: [
            {
              type   : 'empty',
              prompt : 'Inserisci il tuo cognome'
            }
          ]
        },
        datanascita: {
            identifier: 'data_nascita',
            rules: [
                {
                type   : 'empty',
                prompt : 'Inserisci la data di nascita'
                },
                {
                type   : 'regExp[(^((((0[1-9])|([1-2][0-9])|(3[0-1]))|([1-9]))\\x2F(((0[1-9])|(1[0-2]))|([1-9]))\\x2F(([0-9]{2})|(((19)|([2]([0]{1})))([0-9]{2}))))$)]',
                prompt : 'Inserisci una data valida'
                }
            ]
        },
        luogonascita: {
          identifier: 'luogo_nascita',
          rules: [
            {
              type   : 'empty',
              prompt : 'Inserisci il luogo di nascita'
            }
          ]
        },
        email: {
          identifier: 'email',
          rules: [
            {
              type   : 'empty',
              prompt : 'Inserisci il tuo indirizzo email'
            },
            {
              type   : 'email',
              prompt : 'Inserisci una mail valida'
            }
          ]
        },
        cod_fis: {
          identifier: 'CF',
          rules: [
            {
              type   : 'empty',
              prompt : 'Inserisci il tuo codice fiscale'
            },
            {
              type   : 'regExp[^([A-Za-z]{6}[0-9lmnpqrstuvLMNPQRSTUV]{2}[abcdehlmprstABCDEHLMPRST]{1}[0-9lmnpqrstuvLMNPQRSTUV]{2}[A-Za-z]{1}[0-9lmnpqrstuvLMNPQRSTUV]{3}[A-Za-z]{1})|([0-9]{11})$]',
              prompt : 'Inserisci un codice fiscale valido'
            }
          ]
        },
        password1: {
          identifier: 'password1',
          rules: [
            {
              type   : 'empty',
              prompt : 'Inserisci la password'
            },
            {
              type   : 'minLength[6]',
              prompt : 'La password deve essere almeno di {ruleValue} caratteri'
            }
          ]
        },
        password2: {
          identifier: 'password2',
          rules: [
            {
              type   : 'match[password1]',
              prompt : 'Le password non corrispondono'
            }
          ]
        },
        terms: {
          identifier: 'terms',
          rules: [
            {
              type   : 'checked',
              prompt : 'Devi accettare i termini e le condizioni'
            }
          ]
        }
      },
    onSuccess: function(event){
      $('#message').remove();
        $('#register_form').removeClass().addClass('ui loading form segment');
        $.ajax({
            type: 'POST',
            url: "{{ url_for('new_user') }}",
            data: { 
                'nome': $('#register_form').form('get value', 'nome'), 
                'cognome': $('#register_form').form('get value', 'cognome'), 
                //'data_nascita': $('#register_form').form('get value', 'data_nascita'), 
                'data_nascita': mysqlDate, 
                'luogo_nascita': $('#register_form').form('get value', 'luogo_nascita'), 
                'email': $('#register_form').form('get value', 'email'), 
                'CF': $('#register_form').form('get value', 'CF'), 
                'password': hash_SHA1($('#register_form').form('get value', 'password1')), 
            },
            success: function(data){
              $('#register_form').form('reset');
              $("#register_form").css("visibility", "hidden");
              $("#mini_message").css("visibility", "hidden");
              $('#register_form').removeClass().addClass('ui form segment');
              $('#message').remove();
                $('#form_container').prepend(data);
                //new div is called 'message'
                $('#message').show('fast');
            },
            error: function(data) {
              $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
              $('#register_form').removeClass().addClass('ui form segment');
              $('#message').remove();
              if (data){
                $('#form_container').prepend(data);
              } else {
                $('#form_container').prepend('<div id="message" class="ui error mini message"\
                style="display: none;"><div class="header">Si √® verificato un errore nella registrazione</div></div>');
              }
              $('#message').show('fast');
            }
        });
        event.preventDefault();
    }
    })
  ;
  function hash_SHA1(stringToBeHashed){
    sha1(stringToBeHashed);
    var hash = sha1.create();hash.update(stringToBeHashed);
    return hash.hex();
  }

  var today = new Date();
$('#data_nascita')
  .calendar({
    type: 'date',
    monthFirst: false,
    startMode: 'year',
    firstDayOfWeek: 1,
    text: {
      days: ['D', 'L', 'M', 'M', 'G', 'V', 'S'],
      months: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
      monthsShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],
      today: 'Oggi',
      now: 'Ora',
      am: 'AM',
      pm: 'PM'
    },
    formatter: {
      date: function (date, settings) {
        if (!date) return '';
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        return day + '/' + month + '/' + year;
      }
    },
    minDate: new Date(1900, today.getMonth(), today.getDate()),
    maxDate: new Date(today.getFullYear() - 18, today.getMonth(), today.getDate()),
    onChange: function(date){
      if (!date) return '';
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        mysqlDate =  day + '/' + month + '/' + year;
    }
  })
;
</script>

</html>