<html>

<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Site Properties -->
  <title>Profilo</title>
  <link rel="shortcut icon" href="{{ url_for('static', filename = 'favicon.ico') }}" />
  <!-- You MUST include jQuery before Fomantic -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script>
  <script src="{{ url_for('static', filename= '/js/sha1.min.js') }}""></script>

  <style type="text/css">
    .hidden.menu {
      display: none;
    }



    .ui.vertical.stripe {
      padding: 8em 0em;
    }

    .ui.vertical.stripe h3 {
      font-size: 2em;
    }

    .ui.vertical.stripe .button+h3,
    .ui.vertical.stripe p+h3 {
      margin-top: 3em;
    }

    .ui.vertical.stripe .floated.image {
      clear: both;
    }

    .ui.vertical.stripe p {
      font-size: 1.33em;
    }

    .ui.vertical.stripe .horizontal.divider {
      margin: 3em 0em;
    }

    .quote.stripe.segment {
      padding: 0em;
    }

    .quote.stripe.segment .grid .column {
      padding-top: 5em;
      padding-bottom: 5em;
    }

    .footer.segment {
      padding: 5em 0em;
    }

    .secondary.pointing.menu .toc.item {
      display: none;
    }

    @media only screen and (max-width: 700px) {
      .ui.fixed.menu {
        display: none !important;
      }

      .secondary.pointing.menu .item,
      .secondary.pointing.menu .menu {
        display: none;
      }

      .secondary.pointing.menu .toc.item {
        display: block;
      }

      .masthead.segment {
        min-height: 350px;
      }

      .masthead h1.ui.header {
        font-size: 2em;
        margin-top: 1.5em;
      }

      .masthead h2 {
        margin-top: 0.5em;
        font-size: 1.5em;
      }
    }
  </style>
  <script>
    $(document)
      .ready(function () {
        var regione_selezionata;
        $('.ui.dropdown').dropdown({
          on: 'hover',
          allowCategorySelection: true
        });

        // create sidebar and attach to menu open
        $('.ui.sidebar')
          .sidebar('attach events', '.toc.item')
          ;
          if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
            // true for mobile device
            $('.ui.secondary.vertical.pointing.fluid.menu').removeClass('pointing');
          }
          if (getUrlParameter('deleted') == 'False'){
        $('body')
  .toast({
    displayTime: 0,
    closeIcon: true,
    message: "C'è stato un problema con l'eliminazione dell'account."
  })
;
          }
          if (getUrlParameter('changed') == 'True'){
            $('body')
        .toast({
            title: 'La tua password è stata cambiata correttamente',
            message: 'Adesso puoi accedere utilizzando la tua nuova password',
            showProgress: 'bottom',
            classProgress: 'red',
            displayTime: 5000,
        })
        ;
          } else if (getUrlParameter('changed') == 'False'){
        $('body')
  .toast({
    displayTime: 0,
    closeIcon: true,
    message: "C'è stato un problema con il cambiamento della password."
  })
;
          }
          if (getUrlParameter('admin_deleted') == 'True'){
            $('body')
        .toast({
            message: 'Eliminazione effettuata con successo',
            showProgress: 'bottom',
            classProgress: 'red',
            displayTime: 3000,
        })
        ;
          } else if (getUrlParameter('admin_deleted') == 'False'){
        $('body')
  .toast({
    displayTime: 0,
    closeIcon: true,
    message: "C'è stato un problema con l'eliminazione dell'amministratore."
  })
;
          }
          if (getUrlParameter('canceled') == 'True'){
            $('body')
        .toast({
            message: 'Prenotazione annullata con successo',
            showProgress: 'bottom',
            classProgress: 'red',
            displayTime: 3000,
        })
        ;
          } else if (getUrlParameter('canceled') == 'False'){
        $('body')
  .toast({
    displayTime: 0,
    closeIcon: true,
    message: "C'è stato un problema con l'annullamento della prenotazione."
  })
;
          }
          var today = new Date();
          $('#inline_calendar')
          .calendar({
    type: 'date',
    monthFirst: false,
    firstDayOfWeek: 1,
    text: {
      days: ['D', 'L', 'M', 'M', 'G', 'V', 'S'],
      months: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
      monthsShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],
      today: 'Oggi',
      now: 'Ora',
      am: 'AM',
      pm: 'PM'
    },
    formatter: {
      date: function (date, settings) {
        if (!date) return '';
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        return day + '/' + month + '/' + year;
      }
    },
    minDate: new Date(today.getFullYear(), today.getMonth(), today.getDate()),
    maxDate: new Date(today.getFullYear(), today.getMonth() + 6, today.getDate()),
    onChange: function(date){
      check_prenotazioni(date);
    }
  })

      });
      function check_prenotazioni(date){
        $('#cards_dimmer').addClass('active');
      
      
      if (!date) return '';
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        mysqlDate =  day + '/' + month + '/' + year;
        $.ajax({
                type: 'POST',
                url: "{{ url_for('get_prenotazioni_data') }}",
                data: {
                  'admin': $('#id_admin').html(),
                  'data_prenotazione': mysqlDate
                },
                success: function(data){
                  $('#div_cards').html('');
                  for (var i=0;i<data.length;i++){
                    nome = data[i][0]
                    cognome = data[i][1]
                    cod_fis = data[i][2]
                    $('#div_cards').append('<div class="card">' +
                '<div class="content">' +
                  '<div class="header">' + nome + ' ' + cognome + '</div>' +
                  '<div class="description">' +
                    cod_fis +
                    '</div>' +
                    '</div>' +
                    '<div id="complete_button" class="ui bottom attached button">' +
                      '<i class="check icon"></i>' +
                      'Completa prenotazione' +
                      '</div>' +
                      '</div>')
                  }
                  if (data.length == undefined){
                    $('#div_cards').append('<div class="ui fluid container" style="text-align: center;margin-top: 8em;">\
                                            <p>Nessuna prenotazione per il giorno selezionato.</p>\
                                            </div>');
                  }
                  $('#cards_dimmer').removeClass('active');
                  $('.ui.bottom.attached.button').click( function() {
                    cod_fis_completed = $(this).parent().find('.description').html();
    $('body')
  .toast({
    message: 'La prenotazione sarà indicata come completata. Vuoi continuare?',
    displayTime: 0,
    actions:	[{
      text: 'Sì',
      icon: 'check',
      class: 'primary',
      click: function() {
          $('#cards_dimmer').addClass('active');
          $.ajax({
                type: 'POST',
                url: "{{ url_for('complete_reservation') }}",
                data: {
                  'cod_fis': cod_fis_completed
                },
                success: function(data){
                  $('#cards_dimmer').removeClass('active');
                  check_prenotazioni(date);
                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                }
            });
      }
    },{
      text: 'No',
      class: 'red',
      click: function() {}
    }]
  })
;
  });
                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                  $('#cards_dimmer').removeClass('active');
                }
            });
      }
      
      var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return typeof sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
    return false;
};
function get_tot_amministratori(){
  var totale = 0;
  totale += parseInt($('#amm_abruzzo').html()) +
            parseInt($('#amm_basilicata').html()) +
            parseInt($('#amm_calabria').html()) +
            parseInt($('#amm_campania').html()) +
            parseInt($('#amm_emiliaromagna').html()) +
            parseInt($('#amm_friuliveneziagiulia').html()) +
            parseInt($('#amm_lazio').html()) +
            parseInt($('#amm_liguria').html()) +
            parseInt($('#amm_lombardia').html()) +
            parseInt($('#amm_marche').html()) +
            parseInt($('#amm_molise').html()) +
            parseInt($('#amm_piemonte').html()) +
            parseInt($('#amm_pabolzano').html()) +
            parseInt($('#amm_patrento').html()) +
            parseInt($('#amm_puglia').html()) +
            parseInt($('#amm_sardegna').html()) +
            parseInt($('#amm_sicilia').html()) +
            parseInt($('#amm_toscana').html()) +
            parseInt($('#amm_umbria').html()) +
            parseInt($('#amm_valledaosta').html()) +
            parseInt($('#amm_veneto').html());
  return totale;
}
function numberFormat(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}
      function load_page(){
        $.ajax({
                type: 'POST',
                url: "{{ url_for('get_totale_vaccini') }}",
                data: {},
                success: function(data){
                  $('#vaccini_abruzzo').children().children().val(data[0][1]);
                  $('#vaccini_basilicata').children().children().val(data[1][1]);
                  $('#vaccini_calabria').children().children().val(data[2][1]);
                  $('#vaccini_campania').children().children().val(data[3][1]);
                  $('#vaccini_emiliaromagna').children().children().val(data[4][1]);
                  $('#vaccini_friuliveneziagiulia').children().children().val(data[5][1]);
                  $('#vaccini_totale').html('<b>' + data[6][1] + '</b>');
                  $('#vaccini_lazio').children().children().val(data[7][1]);
                  $('#vaccini_liguria').children().children().val(data[8][1]);
                  $('#vaccini_lombardia').children().children().val(data[9][1]);
                  $('#vaccini_marche').children().children().val(data[10][1]);
                  $('#vaccini_molise').children().children().val(data[11][1]);
                  $('#vaccini_piemonte').children().children().val(data[12][1]);
                  $('#vaccini_pabolzano').children().children().val(data[13][1]);
                  $('#vaccini_patrento').children().children().val(data[14][1]);
                  $('#vaccini_puglia').children().children().val(data[15][1]);
                  $('#vaccini_sardegna').children().children().val(data[16][1]);
                  $('#vaccini_sicilia').children().children().val(data[17][1]);
                  $('#vaccini_toscana').children().children().val(data[18][1]);
                  $('#vaccini_umbria').children().children().val(data[19][1]);
                  $('#vaccini_valledaosta').children().children().val(data[20][1]);
                  $('#vaccini_veneto').children().children().val(data[21][1]);
                  $('.ui.dimmer').removeClass().addClass('ui inverted dimmer');
                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                  $('.ui.dimmer').removeClass().addClass('ui inverted dimmer');
                }
            });
            $.ajax({
                type: 'POST',
                url: "{{ url_for('get_amm_regionali') }}",
                data: {},
                success: function(data){
                  data[0][1] != undefined ? $('#amm_abruzzo').html(data[0][2]) : $('#amm_abruzzo').html('0');
                  data[1][1] != undefined ? $('#amm_basilicata').html(data[1][2]) : $('#amm_basilicata').html('0');
                  data[2][1] != undefined ? $('#amm_calabria').html(data[2][2]) : $('#amm_calabria').html('0');
                  data[3][1] != undefined ? $('#amm_campania').html(data[3][2]) : $('#amm_campania').html('0');
                  data[4][1] != undefined ? $('#amm_emiliaromagna').html(data[4][2]) : $('#amm_emiliaromagna').html('0');
                  data[5][1] != undefined ? $('#amm_friuliveneziagiulia').html(data[5][2]) : $('#amm_friuliveneziagiulia').html('0');
                  data[6][1] != undefined ? $('#amm_lazio').html(data[6][2]) : $('#amm_lazio').html('0');
                  data[7][1] != undefined ? $('#amm_liguria').html(data[7][2]) : $('#amm_liguria').html('0');
                  data[8][1] != undefined ? $('#amm_lombardia').html(data[8][2]) : $('#amm_lombardia').html('0');
                  data[9][1] != undefined ? $('#amm_marche').html(data[9][2]) : $('#amm_marche').html('0');
                  data[10][1] != undefined ? $('#amm_molise').html(data[10][2]) : $('#amm_molise').html('0');
                  data[11][1] != undefined ? $('#amm_piemonte').html(data[11][2]) : $('#amm_piemonte').html('0');
                  data[12][1] != undefined ? $('#amm_pabolzano').html(data[12][2]) : $('#amm_pabolzano').html('0');
                  data[13][1] != undefined ? $('#amm_patrento').html(data[13][2]) : $('#amm_patrento').html('0');
                  data[14][1] != undefined ? $('#amm_puglia').html(data[14][2]) : $('#amm_puglia').html('0');
                  data[15][1] != undefined ? $('#amm_sardegna').html(data[15][2]) : $('#amm_sardegna').html('0');
                  data[16][1] != undefined ? $('#amm_sicilia').html(data[16][2]) : $('#amm_sicilia').html('0');
                  data[17][1] != undefined ? $('#amm_toscana').html(data[17][2]) : $('#amm_toscana').html('0');
                  data[18][1] != undefined ? $('#amm_umbria').html(data[18][2]) : $('#amm_umbria').html('0');
                  data[19][1] != undefined ? $('#amm_valledaosta').html(data[19][2]) : $('#amm_valledaosta').html('0');
                  data[20][1] != undefined ? $('#amm_veneto').html(data[20][2]) : $('#amm_veneto').html('0');
                  $('#amm_totale').html(get_tot_amministratori());
                  $('.ui.dimmer').removeClass().addClass('ui inverted dimmer');
                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                  $('.ui.dimmer').removeClass().addClass('ui inverted dimmer');
                }
            });
            $.ajax({
                type: 'POST',
                url: "{{ url_for('get_dettagli_utente') }}",
                data: {},
                success: function(data){
                  $('#data_prenotazione').html('<b>Data prenotazione: </b>' + data['data_prenotazione']);
                  $('#asl_riferimento').html('<b>ASL di riferimento: </b>' + data['asl_riferimento']);
                  $("input[name=CF]").val(data['cod_fis']);
                  $("input[name=email]").val(data['email']);
                  $("input[name=nome]").val(data['nome']);
                  $("input[name=cognome]").val(data['cognome']);
                  $("input[name=data_nascita]").val(data['data_nascita']);
                  $("input[name=luogo_nascita]").val(data['luogo_nascita']);
                  $("input[name=regione]").val(data['regione']);
                  $('.ui.dimmer').removeClass().addClass('ui inverted dimmer');
                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                  $('.ui.dimmer').removeClass().addClass('ui inverted dimmer');
                }
            });
            $.ajax({
                type: 'POST',
                url: "{{ url_for('get_num_prenotazioni') }}",
                data: {},
                success: function(data){
                  if (data['in_attesa'] != undefined){
                    $('#prenotazioni_in_attesa').html(numberFormat(data['in_attesa']));
                    $('#prenotazioni_completate').html(numberFormat(data['completate']));
                    $('#prenotazioni_tot').html(numberFormat(data['in_attesa'] + data['completate']));
                    $('#card_dimmer').removeClass('active');
                  }
                  
                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                  $('#card_dimmer').removeClass('active');
                }
            });
      }
      load_page();
      function hash_SHA1(stringToBeHashed){
    sha1(stringToBeHashed);
    var hash = sha1.create();hash.update(stringToBeHashed);
    return hash.hex();
  }
  </script>
</head>

<body class="pushable">
  
  <!-- Following Menu -->
  <div class="ui large top fixed visible menu">
    <div class="ui container">
      <a class="item" href="{{ url_for('home', param='Home') }}">Home</a>
            <a class="item" href="{{ url_for('home', param='Campagna vaccinale') }}">Campagna vaccinale</a>
            <a class="item" href="{{ url_for('home', param='Info') }}">Info</a>
      <div class="right menu">
        <div class="ui dropdown item" onclick="window.location.href='#'">
          {{ session['nome'] }} <i class="dropdown icon" ></i>
          <div class="menu">
            <a class="item" href="{{ url_for('logout') }}">Logout</a>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Sidebar Menu -->
  <div class="ui vertical inverted sidebar menu left">
    <a class="item" href="{{ url_for('home', param='Home') }}">Home</a>
            <a class="item" href="{{ url_for('home', param='Campagna vaccinale') }}">Campagna vaccinale</a>
            <a class="item" href="{{ url_for('home', param='Info') }}">Info</a>
    <a class="item" href="{{ url_for('login') }}">Login</a>
    <a class="item" href="{{ url_for('register') }}">Registrati</a>
  </div>


  <!-- Page Contents -->
  <div class="pusher">
    <div class="ui container">
      <div class="ui tiny primary menu">
        <a class="toc item">
          <i class="sidebar icon"></i>
        </a>
        <a class="item" href="{{ url_for('home', param='Home') }}">Home</a>
            <a class="item" href="{{ url_for('home', param='Campagna vaccinale') }}">Campagna vaccinale</a>
            <a class="item" href="{{ url_for('home', param='Info') }}">Info</a>
        <div class="ui right dropdown item">
          <a class="ui inverted button" href="{{ url_for('login') }}">Login</a>
          <a class="ui inverted button" href="{{ url_for('register') }}">Registrati</a>
        </div>
      </div>
    </div>

    {% if session['cod_fis'] == 'global_admin' %}
    <h4 class="ui horizontal divider header" style="margin-top: 2em; margin-bottom: 2em;">
      <i class="user cog icon"></i>
      Pannello di amministrazione
    </h4>
    
    <div class="ui container">
      
      <div class="ui mobile reversed grid">
        <div class="four wide computer only column">
          <div class="ui secondary vertical pointing fluid menu">
            <a id="left_menu_first_button" class="item active">
              Vaccini
              <i class="syringe icon"></i>
            </a>
            <a id="left_menu_second_button" class="item">
              Amministratori regionali
              <i class="user cog icon"></i>
            </a>
          </div>
          <div class="ui card" style="margin-top: 6em;">
            <div id="card_dimmer" class="ui active inverted dimmer">
              <div class="ui loader"></div>
            </div>
            <div class="content">
              <div class="header">Prenotazioni</div>
              <div class="description">
                <span id="prenotazioni_in_attesa" class="right floated time"></span>
                <span class="category">In attesa</span>
              </div>
              <div class="description">
                <span id="prenotazioni_completate" class="right floated time"></span>
              <span class="category">Completate</span>
              </div>
            </div>
            <div class="extra content">
              <div class="meta">
                <span id="prenotazioni_tot" class="right floated time"></span>
                <span class="category">Totale</span>
              </div>
            </div>
          </div>
        </div>
        
        <div id="div_vaccini" class="sixteen wide mobile twelve wide computer column" style="display: block; margin-top: -1em;">
          <div id="vaccini_dimmer" class="ui active inverted dimmer">
            <div class="ui loader"></div>
          </div>
          <table id="tab_vaccini" class="ui compact celled unstackable table">
            
            <thead>
              <tr><th>Regione</th>
              <th>N° ASL</th>
              <th class="three wide">Vaccini disponibili</th>
              <th class="two wide">Modifica</th>
            </tr></thead>
            <tbody>
              <tr>
                <td data-label="Regione">Abruzzo</td>
                <td data-label="N° ASL">4</td>
                <td id="vaccini_abruzzo" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_abruzzo_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Basilicata</td>
                <td data-label="N° ASL">2</td>
                <td id="vaccini_basilicata" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_basilicata_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Calabria</td>
                <td data-label="N° ASL">5</td>
                <td id="vaccini_calabria" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_calabria_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Campania</td>
                <td data-label="N° ASL">7</td>
                <td id="vaccini_campania" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_campania_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Emilia Romagna</td>
                <td data-label="N° ASL">8</td>
                <td id="vaccini_emiliaromagna" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_emiliaromagna_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Friuli Venezia Giulia</td>
                <td data-label="N° ASL">5</td>
                <td id="vaccini_friuliveneziagiulia" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_friuliveneziagiulia_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Lazio</td>
                <td data-label="N° ASL">10</td>
                <td id="vaccini_lazio" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_lazio_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Liguria</td>
                <td data-label="N° ASL">5</td>
                <td id="vaccini_liguria" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_liguria_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Lombardia</td>
                <td data-label="N° ASL">8</td>
                <td id="vaccini_lombardia" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_lombardia_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Marche</td>
                <td data-label="N° ASL">1</td>
                <td id="vaccini_marche" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_marche_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Molise</td>
                <td data-label="N° ASL">1</td>
                <td id="vaccini_molise" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_molise_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Piemonte</td>
                <td data-label="N° ASL">12</td>
                <td id="vaccini_piemonte" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_piemonte_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Prov. Auton. Bolzano</td>
                <td data-label="N° ASL">1</td>
                <td id="vaccini_pabolzano" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_pabolzano_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Prov. Auton. Trento</td>
                <td data-label="N° ASL">1</td>
                <td id="vaccini_patrento" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_patrento_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Puglia</td>
                <td data-label="N° ASL">6</td>
                <td id="vaccini_puglia" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_puglia_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Sardegna</td>
                <td data-label="N° ASL">1</td>
                <td id="vaccini_sardegna" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_sardegna_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Sicilia</td>
                <td data-label="N° ASL">9</td>
                <td id="vaccini_sicilia" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_sicilia_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Toscana</td>
                <td data-label="N° ASL">3</td>
                <td id="vaccini_toscana" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_toscana_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Umbria</td>
                <td data-label="N° ASL">2</td>
                <td id="vaccini_umbria" data-label="Vaccini disponibili"><div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div></td>
                <td id="vaccini_umbria_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Valle D'Aosta</td>
                <td data-label="N° ASL">1</td>
                <td id="vaccini_valledaosta" data-label="Vaccini disponibili">
                  <div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div>
                </td>
                <td id="vaccini_valledaosta_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
              <tr>
                <td data-label="Regione">Veneto</td>
                <td data-label="N° ASL">9</td>
                <td id="vaccini_veneto" data-label="Vaccini disponibili">
                  <div class="ui transparent fluid input disabled">
                    <input type="number" value="">
                  </div>
                </td>
                <td id="vaccini_veneto_edit" class="selectable collapsing center aligned" data-label="Modifica">
                  <i class="pen icon"></i>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr><th><b>Totale</b></th>
              <th><b>101</b></th>
              <th id="vaccini_totale"><b>67</b></th>
              <th class="collapsing"></th>
            </tr></tfoot>
          </table>
        
        </div>
        <div id="div_amministratori_regionali" class="sixteen wide mobile twelve wide computer column" style="display: none; margin-top: -1em;" >
          <div id="amm_loader" class="ui inverted dimmer">
            <div class="ui loader"></div>
          </div>
          <table id="region_table" class="ui compact celled selectable unstackable table">
            <thead>
              <tr><th>Regione</th>
              <th>N° ASL</th>
              <th class="three wide">Amm. regionali</th>
            </tr></thead>
            <tbody>
              <tr class="text">
                <td data-label="Regione">Abruzzo</td>
                <td data-label="N° ASL">4</td>
                <td id="amm_abruzzo" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Basilicata</td>
                <td data-label="N° ASL">2</td>
                <td id="amm_basilicata" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Calabria</td>
                <td data-label="N° ASL">5</td>
                <td id="amm_calabria" data-label="Amm. regionali"></td>
                
              </tr>
              <tr class="text">
                <td data-label="Regione">Campania</td>
                <td data-label="N° ASL">7</td>
                <td id="amm_campania" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Emilia Romagna</td>
                <td data-label="N° ASL">8</td>
                <td id="amm_emiliaromagna" data-label="Amm. regionali"></td>
                
              </tr>
              <tr class="text">
                <td data-label="Regione">Friuli Venezia Giulia</td>
                <td data-label="N° ASL">5</td>
                <td id="amm_friuliveneziagiulia" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Lazio</td>
                <td data-label="N° ASL">10</td>
                <td id="amm_lazio" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Liguria</td>
                <td data-label="N° ASL">5</td>
                <td id="amm_liguria" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Lombardia</td>
                <td data-label="N° ASL">8</td>
                <td id="amm_lombardia" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Marche</td>
                <td data-label="N° ASL">1</td>
                <td id="amm_marche" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Molise</td>
                <td data-label="N° ASL">1</td>
                <td id="amm_molise" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Piemonte</td>
                <td data-label="N° ASL">12</td>
                <td id="amm_piemonte" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Prov. Auton. Bolzano</td>
                <td data-label="N° ASL">1</td>
                <td id="amm_pabolzano" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Prov. Auton. Trento</td>
                <td data-label="N° ASL">1</td>
                <td id="amm_patrento" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Puglia</td>
                <td data-label="N° ASL">6</td>
                <td id="amm_puglia" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Sardegna</td>
                <td data-label="N° ASL">1</td>
                <td id="amm_sardegna" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Sicilia</td>
                <td data-label="N° ASL">9</td>
                <td id="amm_sicilia" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Toscana</td>
                <td data-label="N° ASL">3</td>
                <td id="amm_toscana" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Umbria</td>
                <td data-label="N° ASL">2</td>
                <td id="amm_umbria" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Valle D'Aosta</td>
                <td data-label="N° ASL">1</td>
                <td id="amm_valledaosta" data-label="Amm. regionali"></td>
              </tr>
              <tr class="text">
                <td data-label="Regione">Veneto</td>
                <td data-label="N° ASL">9</td>
                <td id="amm_veneto" data-label="Amm. regionali"></td>
              </tr>
            </tbody>
            <tfoot>
              <tr><th><b>Totale</b></th>
              <th><b>101</b></th>
              <th id="amm_totale"></th>
            </tr></tfoot>
          </table>
          
        </div>
        <div id="div_regioni" class="sixteen wide mobile twelve wide computer column" style="display: none;">
          <table id="admin_table" class="ui compact celled unstackable table">
            <thead>
              <tr>
                <th >ASL</th>
                <th>Amm. regionale</th>
                <th class="two wide">Modifica</th>
            </tr>
          </thead>
            <tbody id="admin_table_body">
            </tbody>
          </table>
          <div id="button_container" class="ui fluid container" style="margin-top: 1em; display: none;">
            <button id="back_button" class="ui left floated button"><i class="arrow left icon"></i>Indietro</button>
              <button id="add_button" class="ui right floated primary button"><i class="user plus icon"></i>Aggiungi</button>
          </div>
        </div>
      </div>
    </div>
    {% elif session['cod_fis'] == 'region' %}
    <h4 class="ui horizontal divider header" style="margin-top: 2em; margin-bottom: 2em;">
      <i class="user cog icon"></i>
      Pannello di amministrazione
    </h4>
    <p id="id_admin" style="display: none;">{{ session['email']}}</p>
    <div class="ui container">
      
      <div class="ui mobile reversed grid">
        <div class="four wide computer only column">
          <div class="ui secondary vertical pointing fluid menu">
            <a id="left_menu_region_first_button" class="item active" style="cursor: default;">
              Prenotazioni
              <i class="calendar check icon"></i>
            </a>
          </div>
          <div class="ui calendar" id="inline_calendar" style="margin-top: 4em;">
          </div>
          <div class="ui segment">
            <p>Scegli una data per visualizzare le prenotazioni</p>
          </div>
        </div>
        
        <div class="sixteen wide mobile twelve wide computer column" style="display: block; margin-top: -1em;">
          <div id="cards_dimmer" class="ui inverted dimmer">
            <div class="ui loader"></div>
          </div>
          <div id="div_cards" class="ui three cards" style="margin-top: 0.2em;">
            
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <h4 class="ui horizontal divider header">
      <i class="user icon"></i>
      Profilo
    </h4>
    <div class="ui container">

      <div class="ui mobile reversed grid">
        <div class="row">
          <div class="sixteen wide mobile four wide computer column">
            <div class="ui secondary vertical pointing fluid menu">
              <a id="left_menu_user_first_button" class="item active">
                Prenotazioni effettuate
                <i class="calendar icon"></i>
              </a>
              <a id="left_menu_user_second_button" class="item">
                Dati personali
                <i class="address card icon"></i>
              </a>
            </div>
          </div>
          <div id="div_prenotazioni" class="sixteen wide mobile twelve wide computer column" style="display: block;">
            <div class="ui active inverted dimmer">
              <div class="ui loader"></div>
            </div>
            {% if reservation == True %}
            <div class="ui last container">
              <div class="ui segment">
                <div id="annulla_prenotazione_dimmer" class="ui inverted dimmer">
                  <div class="ui loader"></div>
                </div>
               <div class="ui header">
                 <p>Dettagli prenotazione</p>
               </div>
               <div class="ui divider"></div>
               <p id="data_prenotazione"></p>
               <p id="asl_riferimento" style="margin-bottom: 4em;"></p>
               <div class="ui divider"></div>
               <div class="ui three column grid">
                 <div class="row">
                   <div class="column"></div>
                   <div class="column"></div>
                   <div class="right floated column">
                    <div id="annulla_prenotazione" class="right floated ui primary button" >Annulla prenotazione</div>
                   </div>
                 </div>
               </div>
              </div>
            </div>
            {% elif reservation == False %}
            <div class="ui last container">
              <div class="ui placeholder segment">
               <div class="ui icon header">
                 <p>Non hai effettuato ancora una prenotazione</p>
               </div>
               <a href="{{ url_for('reserve') }}" class="ui primary button">Prenota ora</a>
              </div>
            </div>
            {% endif %}
            <p style="margin-top: 3em;">Se riscontri problemi, invia una email a <code style="color: #2185d0;">info.vaccitaly@gmail.com</code>.</p>
          
          </div>
          <div id="div_dati_personali" class="sixteen wide mobile twelve wide computer column" style="display: none;">
            <form class="ui equal width form segment">
              <div class="fields">
                <div class="field">
                  <label>Nome</label>
                  <input placeholder="" readonly="" name="nome" type="text">
                </div>
                <div class="field">
                  <label>Cognome</label>
                  <input placeholder="" readonly="" name="cognome" type="text">
                </div>
              </div>
              <div class="fields">
                  <div class="field">
                      <label>Data di nascita</label>
                      <input placeholder="" readonly="" name="data_nascita" type="text">
                    </div>
                    <div class="field">
                      <label>Luogo di nascita</label>
                      <input placeholder="" readonly="" name="luogo_nascita" type="text" >
                    </div>
                    <div class="field">
                      <label>Codice fiscale</label>
                      <input placeholder="" readonly="" name="CF" type="text" style="text-transform:uppercase">
                    </div>
              </div>
              <div class="fields">
                <div class="field">
                  <label>Regione</label>
                  <input placeholder="Non impostata" readonly="" name="regione" type="text">
                </div>
                <div class="field">
                  <label>Email</label>
                  <input placeholder="" readonly="" name="email" type="email">
                </div>
              </div>
              <div class="ui divider"></div>
               <div class="ui four column grid">
                 <div class="computer only row">
                   <div class="computer only column"></div>
                   <div class="computer only column"></div>
                   <div class="right floated computer column">
                    <div id="cambia_password" class="fluid ui primary button" >Cambia password</div>
                   </div>
                   <div class="right floated computer column">
                    <div id="elimina_account" class="fluid ui red button" >Elimina account</div>
                   </div>
                 </div>
               </div>
               <div class="ui mobile only two column grid">
                <div class="row">
                  <div class="column">
                   <div id="cambia_password" class="fluid ui primary button" >Cambia password</div>
                  </div>
                  <div class=" column">
                   <div id="elimina_account" class="fluid ui red button" >Elimina account</div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div id="div_cambia_password" class="sixteen wide mobile twelve wide computer column" style="display: none;">
            <form id="change_password_form" class="ui equal width form segment">
              <div class="ui two column grid">
                <div class="column">
                  <div class="row">
                    <div class="fields">
                      <div class="field">
                        <label>Password attuale</label>
                        <input placeholder="" name="old_password" type="password">
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="fields">
                      <div class="field">
                        <label>Nuova password</label>
                        <input placeholder="" name="new_password" type="password">
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="fields">
                      <div class="field">
                        <label>Conferma password</label>
                        <input placeholder="" name="confirm_password" type="password">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div class="ui error message" style="margin-top:1.6em;"></div>
                </div>
              </div>
              <div class="ui divider"></div>
               <div class="ui four column grid">
                 <div class="computer only row">
                   <div class="computer only column"></div>
                   <div class="computer only column"></div>
                   <div class="right floated computer column">
                   </div>
                   <div class="right floated computer column">
                    <div id="send_password" class="fluid ui submit button primary" >Cambia</div>
                   </div>
                 </div>
               </div>
               <div class="ui mobile only two column grid">
                <div class="row">
                  <div class="column">
                  </div>
                  <div class=" column">
                   <div id="send_password" class="fluid ui submit button primary" >Cambia</div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div id="div_conferma_eliminazione" class="sixteen wide mobile twelve wide computer column" style="display: none;">
            <div class="ui active inverted dimmer">
              <div class="ui loader"></div>
            </div>
            <div class="ui last container">
              <div class="ui placeholder segment" style=" padding-top: 7.4em; padding-bottom: 7.4em;">
                <div class="ui icon header">
                  Vuoi davvero eliminare il tuo account? 
                  <p>Questa è un'operazione irreversibile.</p>
                </div>
                <div class="inline">
                  <div id="delete_account_confirm_button" class="ui red button">Elimina</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    {% include 'footer.html' %}
  </div>
  <div class="ui small modal">
    <div id="modal_dimmer" class="ui inverted dimmer">
      <div class="ui loader"></div>
    </div>
    <div id="modal_title" class="header">Aggiungi ammistratore regionale</div>
      <div class="content">
        <form id="admin_form" class="ui fluid form">
          <div class="two fields">
            <div class="field">
              <label>ID amministratore</label>
              <input id="modal_id_amm" placeholder="" name="id_amm" type="text">
              <input id="modal_old_id_amm" placeholder="" name="old_id_amm" type="hidden">
            </div>
            <div id="asl_select" class="field">
              
            </div>
          </div>
          <div class="two fields">
            <div class="field">
              <label>Nome (facoltativo)</label>
              <input id="modal_id_name" placeholder="" name="nome_admin" type="text">
            </div>
            <div class="field">
              <label>Cognome (facoltativo)</label>
              <input id="modal_id_surname" type="text" name="cognome_admin">
            </div>
          </div>
          <div class="two fields">
            <div class="field">
              <label>Password</label>
              <input placeholder="" name="password1_admin" type="password">
            </div>
            <div class="field">
              <label>Conferma password</label>
              <input type="password" name="password2_admin">
            </div>
          </div>
          <div id="modal_error_message" class="ui error message"></div>
        </form>
        
      </div>
      <div class="actions">
        <div class="ui cancel button">Annulla</div>
        <div id="modal_delete_button" class="ui red button" style="display: none;">Elimina</div>
        <div id="modal_confirm_button" class="ui approve primary button">Conferma</div>
      </div>
  </div>
</body>
<script>
  $('.selectable.collapsing.center.aligned').click( function(event) {
    var selected = event.currentTarget.id
    selected = selected.substring(0, selected.length - 5);
    //se sto salvando
    if (this.innerHTML == '<i class="save icon"></i>'){
      if ($('#' + selected).children().children().val() < 0 || $('#' + selected).children().children().val() > 60000000){
        $('#' + selected).removeClass().addClass('error');
        $('#' + selected).attr('data-tooltip','Inserisci un valore valido');
      } else {
        $('#' + selected).removeAttr('data-tooltip');
        $('#' + selected).removeClass();
        $('#' + selected).children().removeClass().addClass('ui transparent fluid input disabled')
        event.currentTarget.innerHTML = '<i class="pen icon"></i>'
        $('#vaccini_dimmer').removeClass().addClass('ui active inverted dimmer');
        $('.pen.icon').parent().removeClass().addClass('selectable collapsing center aligned')
        $.ajax({
            type: 'POST',
            url: "{{ url_for('edit_vaccini') }}",
            data: { 
                'regione': selected.substring(8, selected.length),
                'num_vaccini': $('#' + selected).children().children().val()
            },
            success: function(data){
              load_page();
            },
            error: function(data) {
              $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
              console.log(data)
            }
        });
      }
    } 
    else { //se sto modificando
      $('#' + selected).children().removeClass().addClass('ui transparent fluid input');
      event.currentTarget.innerHTML = '<i class="save icon"></i>';
      $('.pen.icon').parent().removeClass().addClass('selectable collapsing center aligned disabled');
    }
  });
  $("#admin_table").on('click','.selectable.collapsing.center.aligned.edit',function(event){
    $('#modal_delete_button').css('display','inline');
    $('#admin_form').form('reset');
    $('#select_option').val($(this).siblings()[0].innerHTML).change();
    $('#modal_id_amm').val($(this).siblings()[1].innerHTML);
    $('#modal_old_id_amm').val($(this).siblings()[1].innerHTML);
    $('#modal_id_name').val($(this).siblings()[2].innerHTML);
    $('#modal_id_surname').val($(this).siblings()[3].innerHTML);
    $('#modal_title').html('Modifica amministratore regionale');
    $('.small.modal')
  .modal({
    inverted: true,
    closable: false,
    onDeny    : function(){
      $('#admin_form').form('reset');
    },
    onApprove : function() {
      return false;
    }
  })
  .modal('setting', 'transition', 'Fade Up')
  .modal('show')
  ;
  });
  $('#left_menu_first_button').click( function() {
    $('#div_amministratori_regionali').css('display','none');
    $('#div_vaccini').css('display','block');
    $('#div_regioni').css('display', 'none');
    $('#left_menu_first_button').removeClass().addClass('item active');
    $('#left_menu_second_button').removeClass().addClass('item');
  });
  $('#left_menu_second_button').click( function() {
    $('#div_vaccini').css('display','none');
    $('#div_amministratori_regionali').css('display','block');
    $('#div_regioni').css('display', 'none');
    $('#left_menu_first_button').removeClass().addClass('item');
    $('#left_menu_second_button').removeClass().addClass('item active');
  });
  $('#left_menu_user_first_button').click( function() {
    $('#div_dati_personali').css('display','none');
    $('#div_cambia_password').css('display','none');
    $('#div_prenotazioni').css('display','block');
    $('#div_conferma_eliminazione').css('display','none');
    $('#left_menu_user_first_button').removeClass().addClass('item active');
    $('#left_menu_user_second_button').removeClass().addClass('item');
  });
  $('#left_menu_user_second_button').click( function() {
    $('#div_prenotazioni').css('display','none');
    $('#div_dati_personali').css('display','block');
    $('#div_cambia_password').css('display','none');
    $('#div_conferma_eliminazione').css('display','none');
    $('#left_menu_user_first_button').removeClass().addClass('item');
    $('#left_menu_user_second_button').removeClass().addClass('item active');
  });
  function numberFormat(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}
$('.fluid.ui.red.button').click( function() {
  $('.ui.dimmer').addClass('active');
  $('#div_dati_personali').css('display','none');
  $('#div_cambia_password').css('display','none');
  $('#div_conferma_eliminazione').css('display','block');
  setTimeout(function(){ 
    $('.ui.dimmer').removeClass('active');
  }, 300);
  
});
$('.ui.dropdown')
  .dropdown();
$('#add_button').click(function() {
  $('#modal_delete_button').css('display','none');
  $('#admin_form').form('reset');
  $('#modal_title').html('Aggiungi amministratore regionale');
  $('.small.modal')
  .modal({
    inverted: true,
    closable: false,
    onDeny    : function(){
      $('#admin_form').form('reset');
    },
    onApprove : function() {
      return false;
    }
  })
  .modal('setting', 'transition', 'Fade Up')
  .modal('show')
  ;
  
});
$('#modal_delete_button').click( function() {
  $('body')
  .toast({
    message: 'Sei sicuro di voler eliminare l\'amministratore?',
    displayTime: 0,
    actions:	[{
      text: 'Sì',
      icon: 'check',
      class: 'primary',
      click: function() {
        $('#modal_dimmer').addClass('active');
          $.ajax({
                type: 'POST',
                url: "{{ url_for('delete_admin') }}",
                data: {
                  'id_amm': $("input[name=old_id_amm]").val()
                },
                success: function(data){
                  if (data == true){
                    window.location.href = window.location.href.replace( /[\?#].*|$/, "?admin_deleted=True" );
                  } else {
                    window.location.href = window.location.href.replace( /[\?#].*|$/, "?admin_deleted=False" );
                  }
                  
                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                }
            });
      }
    },{
      text: 'No',
      class: 'red',
      click: function() {}
    }]
  })
;
});
$('#admin_form')
  .form({
    fields: {
      name: {
        identifier: 'id_amm',
        rules: [
          {
            type   : 'empty',
            prompt : 'Inserisci l\'ID amministratore'
          }
        ]
      },
      password1: {
        identifier: 'password1_admin',
        rules: [
          {
            type   : 'empty',
            prompt : 'Inserisci la password'
          },
          {
            type   : 'minLength[6]',
            prompt : 'La password deve contenere almeno {ruleValue} caratteri'
          }
        ]
      },
      password2: {
        identifier: 'password2_admin',
        rules: [
          {
            type   : 'match[password1_admin]',
            prompt : 'Le password non corrispondono'
          }
        ]
      }
    }
  })
;
$('#modal_confirm_button').click( function() {
  $('#admin_form').form('validate form');
      if( $('#admin_form').form('is valid')) {
        $('#modal_dimmer').addClass('active');
        if ($('#modal_title').html() == 'Aggiungi amministratore regionale'){
          $.ajax({
            type: 'POST',
            url: "{{ url_for('new_admin') }}",
            data: { 
                'regione': regione_selezionata,
                'id_amm': $("input[name=id_amm]").val(),
                'asl': $("#select_option").val(),
                'nome': $("input[name=nome_admin]").val(),
                'cognome': $("input[name=cognome_admin]").val(),
                'password': hash_SHA1($("input[name=password1_admin]").val())
            },
            success: function(data){
              if (data == true){
                $('.ui modal').modal('hide');
                location.reload();
              } else {
                $('#admin_form').form('reset')
                $('#admin_form').form('add errors',['ID amministratore già esistente.'])
              }
              $('#modal_dimmer').removeClass('active');
            },
            error: function(data) {
              $('#modal_dimmer').removeClass('active');
              $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
              console.log(data)
            }
        });
        } else {
            $.ajax({
              type: 'POST',
              url: "{{ url_for('edit_admin') }}",
              data: { 
                  'regione': regione_selezionata,
                  'old_id_amm': $("input[name=old_id_amm]").val(),
                  'asl': $("#select_option").val(),
                  'nome': $("input[name=nome_admin]").val(),
                  'cognome': $("input[name=cognome_admin]").val(),
                  'password': hash_SHA1($("input[name=password1_admin]").val()),
                  'new_id_amm': $("input[name=id_amm]").val(),
              },
              success: function(data){
                if (data == true){
                  $('.ui modal').modal('hide');
                  location.reload();
                } else {
                  $('#admin_form').form('reset')
                  $('#admin_form').form('add errors',['Si è verificato un errore.'])
                }
                $('#modal_dimmer').removeClass('active');
              },
              error: function(data) {
                $('#modal_dimmer').removeClass('active');
                $.ajax({
                      type: 'POST',
                      url: "{{ url_for('auto_report_bug') }}",
                      data: { 'error': data }
                  });
                console.log(data)
              }
          });
        }
      } 
});
$('#delete_account_confirm_button').click( function() {
  $('.ui.dimmer').addClass('active');
  $.ajax({
            type: 'POST',
            url: "{{ url_for('delete_account') }}",
            data: { 
                'email': $("input[name=email]").val()
            },
            success: function(data){
              window.location=data.result;
            },
            error: function(data) {
              $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
              console.log(data)
            }
        });
});
$('.fluid.ui.primary.button').click( function() {
  $('#div_dati_personali').css('display','none');
  $('#div_cambia_password').css('display','block');
});

$('#change_password_form')
    .form({
        fields: {
          old_password: {
                identifier: 'old_password',
                rules: [
                    {
                        type: 'empty',
                        prompt: 'Inserisci la tua password attuale'
                    }
                ]
            },
            new_password: {
                identifier: 'new_password',
                rules: [
                    {
                        type: 'minLength[6]',
                        prompt: 'La nuove password deve contenere almeno {ruleValue} caratteri'
                    }
                ]
            },
            confirm_password: {
                identifier: 'confirm_password',
                rules: [
                    {
                        type: 'match[new_password]',
                        prompt: 'Le password devono corrispondere'
                    }
                ]
            }
        },
        onSuccess: function(event){
          $('#change_password_form').addClass('loading')
          $.ajax({
                type: 'POST',
                url: "{{ url_for('change_password') }}",
                data: {
                  'old_password': hash_SHA1($('#change_password_form').form('get value', 'old_password')),
                  'new_password': hash_SHA1($('#change_password_form').form('get value', 'new_password'))
                },
                success: function(data){
                  window.location=data.result;

                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                }
            });
        event.preventDefault();
    }
  })
  ;
  $('#annulla_prenotazione').click( function() {
    $('body')
  .toast({
    message: 'Vuoi annullare la prenotazione?',
    displayTime: 0,
    actions:	[{
      text: 'Sì',
      icon: 'check',
      class: 'primary',
      click: function() {
          $('#annulla_prenotazione_dimmer').addClass('active');
          $.ajax({
                type: 'POST',
                url: "{{ url_for('cancel_reservation') }}",
                data: {},
                success: function(data){
                  window.location=data.result;

                },
                error: function(data) {
                  $.ajax({
                    type: 'POST',
                    url: "{{ url_for('auto_report_bug') }}",
                    data: { 'error': data }
                });
                  console.log(data)
                }
            });
      }
    },{
      text: 'No',
      class: 'red',
      click: function() {}
    }]
  })
;
  });
  function get_admin_regione(){
    $.ajax({
          type: 'POST',
          url: "{{ url_for('get_admin_regione') }}",
          data: { 
            'regione': regione_selezionata
          },
          success: function(data){
            console.log(data)
            $('#asl_select').html('');
            var data_set = [];
            var html_to_append = "<label>ASL</label>" +
                           "<select id=\"select_option\" name=\"asl\" class=\"ui dropdown\">";
            for (var i=0;i<data.length;i++){
              if (data[i][0] != null){
                $('#admin_table_body').append("<tr>"+
              "<td data-label=\"ASL\">" + data[i][6] + "</td>"+
              "<td data-label=\"Amm. regionale\">" + data[i][0] + "</td>"+
              "<td style=\"display:none;\">" + data[i][3] + "</td>"+
              "<td style=\"display:none;\">" + data[i][4] + "</td>"+
              "<td class=\"selectable collapsing center aligned edit\" data-label=\"Modifica\"><i class=\"pen icon\"></i></td>"+
              "</tr>");
              }
              if (!data_set.includes(data[i][6])){
                data_set.push(data[i][6]);
              }
            }
            for (var i=0; i<data_set.length;i++){
              html_to_append += "<option value=\"" + data_set[i] + "\">" + data_set[i] + "</option>";
            }
            html_to_append += "</select>";
            $('#asl_select').append(html_to_append);
            $('#div_amministratori_regionali').css('display','none');
            $('#button_container').css('display', 'block');
            $('#div_regioni').css('display', 'block');
            $('#amm_loader').removeClass('active');
            $('.ui.dropdown')
                .dropdown();
            },
          error: function(data) {
            $.ajax({
              type: 'POST',
              url: "{{ url_for('auto_report_bug') }}",
              data: { 'error': data }
          });
            console.log(data)
          }
    });
  }
  $('.text').click( function() {
    $('#admin_table_body').html('');
    $('#amm_loader').addClass('active');
    regione_selezionata = $(this).children().first().html();
    get_admin_regione();
  });
  $('#back_button').click( function() {
    $('#div_regioni').css('display', 'none');
    $('#button_container').css('display', 'none');
    $('#div_amministratori_regionali').css('display','block');
  });
</script>

</html>